define(["jquery","pages/spark/app","js/lib/cookie","js/lib/modals","spark/app/signature/js/signatureTrackLastChanceModal.html","spark/app/signature/js/flexjoinLastChanceModal.html","js/lib/coursera.ab","js/lib/util","js/lib/path"],function($,Coursera,Cookie,Modal,signatureTrackLastChanceModal,flexjoinLastChanceModal,AB,util,path){var functionList={addLastChanceModalInteraction:function($el){if(!Coursera.user.get("last_access_time"))return;var signup_url=Coursera.course.get("host")+"signature/course/"+Coursera.course.get("shortname")+"/"+Coursera.course.get("id"),specialization=Coursera.course.get("specialization");if(specialization)signup_url=Coursera.course.get("host")+"specialization/"+specialization.short_name+"/"+specialization.id;var sigtrackStatus=Coursera.course.get("signatureTrackStatus");if(1!==sigtrackStatus.signature_track_enabled)return;if(1===sigtrackStatus.signature_track_sign_up_now&&!Coursera.user.inSignatureTrack()&&!Coursera.user.isStaffOrSuperuser()){if(1!=Cookie.get("spark_signaturetrack_hide")){var join_label=null,join_st_button=null;if(!specialization){var join_label_id=AB.session.getExperiment("sigtrack_demonstrated_uses2").getChosenVariant();join_label={base:"Earn a Verified Certificate!","show-qualifications":"Show Your New Qualifications with a Verified Certificate","further-qualifications":"Deepen Your Qualifications with a Verified Certificate","list-resume":"Upgrade Your Resume with a Verified Certificate","list-cv":"Upgrade Your C.V. with a Verified Certificate","add-linkedin":"Add Verified Certificates to Your LinkedIn Profile","official-rec":"Earn Official Recognition from Top Universities","rec-achievement":"Get Recognition for Your Achievement with a Verified Certificate","link-identity":"Link Your Coursework to Your Identity","commitment-complete":"Motivate Yourself to Complete with a Verified Certificate","share-certificate":"Share Your Achievement With a Unique Certificate URL","share-records":"Show Your Success with Shareable Course Records","advance-career":"Advance Your Career with Verified Certificates","present-employer":"Gain Workplace Recognition, Earn Your Verified Certificate"}[join_label_id],join_st_button="Get Started"}else if(specialization)join_label='The "'+Coursera.course.get("specialization").name+'" Specialization',join_st_button="Learn More";$("body").prepend("<div class='course-signaturetrack-topbanner'>  <span class='course-signaturetrack-topbanner-close'>    <a href='#'>&times;</a>  </span>  <span class='course-signaturetrack-topbanner-text'>"+join_label+"  </span>  <span class='course-signaturetrack-topbanner-button'>    <a target='_new' href='"+signup_url+"?utm_source=spark&utm_medium=banner'>"+join_st_button+"</a>  </span></div>"),$(".course-signaturetrack-topbanner-close").click(function(){$(".course-signaturetrack-topbanner").hide(),Cookie.set("spark_signaturetrack_hide",1,{expires:new Date("2020"),path:"/"+Coursera.course.get("sessionName")})})}var makeLastChanceModal=function(modalTemplate,arg){return $(modalTemplate({ribbon:arg.ribbon,universityLogo:arg.universityLogo,certBaseImage:arg.certBaseImage,studentName:arg.studentName,course:arg.course,specialization:arg.course.get("specialization"),timeLeft:arg.timeLeft,closeDate:arg.closeDate}))},sigtrackLastChance=sigtrackStatus.signature_track_last_chance_dialog&&!Coursera.user.get("last_chance_modal"),flexjoinLastChance=sigtrackStatus.flexjoin_last_chance_dialog&&!Coursera.user.get("flexjoin_last_chance_modal");if(!util.isMobileDevice()&&(sigtrackLastChance||flexjoinLastChance)){var $modalDiv,args={ribbon:path.join(Coursera.course.get("assetUnversionedLink"),"pages/signature/views/ribbon_stripes.png"),timeLeft:sigtrackStatus.signature_track_duration_left,course:Coursera.course,studentName:Coursera.user.get("full_name"),certBaseImage:path.join(Coursera.course.get("assetUnversionedLink"),"images/signature/template-cert-preview.png"),universityLogo:path.join(Coursera.course.get("host"),"/maestro/api/course/",Coursera.course.get("id"),"/university_logo"),closeDate:sigtrackStatus.flexjoin_registration_close_date};if(sigtrackLastChance)$modalDiv=makeLastChanceModal(signatureTrackLastChanceModal,args);else if(flexjoinLastChance)$modalDiv=makeLastChanceModal(flexjoinLastChanceModal,args);var modal=new Modal($modalDiv,{"overlay.class":"coursera-signature-modal-overlay-darker","overlay.close":!1});modal.on("open",function(){if($(".course-signaturetrack-modal-learnmore").on("click",function(){window.open(signup_url+"?utm_source=spark&utm_medium=lastchance")}),Coursera.course.get("specialization"))$(".course-specialization-modal-learnmore").on("click",function(){window.open(signup_url+"?utm_source=spark&utm_medium=lastchance")})}),modal.on("close",function(){if(sigtrackStatus.signature_track_last_chance_dialog)Coursera.api.get("signature/user/set_signature_track_last_chance");if(sigtrackStatus.flexjoin_last_chance_dialog)Coursera.api.get("signature/user/set_flexjoin_last_chance")}),modal.open()}}}};return functionList});