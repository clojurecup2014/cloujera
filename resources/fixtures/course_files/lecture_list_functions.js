!function(){var Module=function($,Coursera,Modal){function getCourseBase(){var courseBase=$("[data-lecture-coursebase]").attr("data-lecture-coursebase");return courseBase}function pushLecture(lectureId){var stateUrl=getCourseBase()+"lecture/"+lectureId;History.pushState(null,null,stateUrl)}function showLecture(lectureId){var anchor=lectureAnchors[lectureId],title=$.trim(anchor.text());$("title").text(title);var outer_frame=$(".course-modal-frame");if(anchor.hasClass("lecture-with-slides-link"))outer_frame.addClass("course-modal-frame-with-slides");else outer_frame.removeClass("course-modal-frame-with-slides");if($(".course-modal-frame-title").text(title),!coursera_enable_new_help_center){var reporterLink=$(".course-modal-frame-title-reporter-link")[0],baseUrl=reporterLink.protocol+"//"+reporterLink.host+reporterLink.pathname,newLink=baseUrl+"?url="+encodeURIComponent(window.location.href);$(".course-modal-frame-title-reporter-link").attr("href",newLink)}anchor.click()}window.savedScrollTop=0,window.enterFullScreen=function(){$(".course-modal-frame").addClass("fullscreen-block"),Modal($(".course-modal-frame")).reposition(),$("html, body").css("overflow","hidden"),savedScrollTop=$(window).scrollTop(),$(window).scrollTop(0)},window.exitFullScreen=function(){$(".course-modal-frame").removeClass("fullscreen-block"),Modal($(".course-modal-frame")).reposition(),$("html, body").css("overflow","auto"),$(window).scrollTop(savedScrollTop)};var lectureOrder=[],lectureAnchors={},listTitle="";window.viewPrevLecture=function viewPrevLecture(lectureId){var i=lectureOrder.indexOf(lectureId);if(-1===i)throw"unknown lectureId '"+lectureId+"'";if(0===i)return;else{var prevLectureId=lectureOrder[i-1];pushLecture(prevLectureId)}},window.viewNextLecture=function viewNextLecture(lectureId){var i=lectureOrder.indexOf(lectureId);if(-1===i)throw"unknown lectureId '"+lectureId+"'";if(i===lectureOrder.length-1)return;else{var nextLectureId=lectureOrder[i+1];pushLecture(nextLectureId)}},window.hasNextLecture=function hasNextLecture(lectureId){var i=lectureOrder.indexOf(lectureId);if(-1===i)return!1;return i!==lectureOrder.length-1};var inLecture=!1,pushClose=!0,getAction=function(url){var parser=document.createElement("a");parser.href=url;var slashSplit=parser.pathname.split("/"),action=slashSplit[slashSplit.length-1];return action};$(document).ready(function(){$("a[rel=lecture-link]").each(function(){var lectureId=$(this).attr("data-lecture-id");lectureOrder.push(lectureId),lectureAnchors[lectureId]=$(this)}),modal=Modal(".course-modal-frame"),modal.on("open",function(){inLecture=!0}),modal.on("close",function(){if(inLecture=!1,pushClose)History.pushState(null,null,getCourseBase()+"lecture")}),$(window).bind("statechange",function(){var state=History.getState(),action=getAction(state.url);if(!isNaN(action))showLecture(action);else if("index"===action)pushClose=!1,Modal(".course-modal-frame").close(),pushClose=!0}),$(".lecture-link").each(function(){var lectureId=$(this).attr("data-lecture-id");$(this).click(function(e){if(e.originalEvent)pushLecture(lectureId)})}),$(".item-resource a[rel=tooltip]").tooltip({animation:!1}),$(".lecture-link, .lecture-with-slides-link").click(function(){$(this).parent().removeClass("unviewed").prepend('<span class="icon-ok"></span>')}),listTitle=$("title").text();var action=getAction(window.location);if("?preview=1"==location.search)Modal(".course-modal-frame",{"iframe.url":"/"+Coursera.course.get("sessionName")+"/lecture/view?lecture_id="+action+"&preview=1"}).open();else if(!isNaN(action))showLecture(action);if($(".course-linkable-locked").length>0){var canSignUp=function(){$(".course-is-locked-loading-course-info").hide(),$(".course-is-locked-can-sign-up").show()},cantSignUp=function(){$(".course-is-locked-loading-course-info").hide(),$(".course-is-locked-cant-sign-up").show()},shortName=$(".course-linkable-locked").attr("data-linkable-topic-id"),courseId=$(".course-linkable-locked").attr("data-linkable-course-id"),siteUrl=$(".course-linkable-locked").attr("data-linkable-site-url");$.ajax(siteUrl+"/maestro/api/topic/information?topic-id="+shortName,{dataType:"jsonp"}).done(function(data){for(var courses=data.courses,k=0;k<courses.length;k++)if(courses[k].id==courseId&&1==courses[k].status)return void canSignUp();cantSignUp()}).fail(cantSignUp),$("[data-if-linkable]").each(function(){for(var $el=$(this),options=$el.attr("data-if-linkable").split(","),i=0;i<options.length;i++){var option=options[i];if("modal-lock"==option)$el.attr("data-modal",".course-is-locked-modal");if("gray"==option)$el.css("color","gray");if("lock-icon"==option)$el.append($('<span class="icon-lock"><span class="accessible-text-for-reader">Sign in to access this link</span></span>'));if("add-referrer"==option){var href=$el.attr("href"),separator=-1==href.indexOf("?")?"?":"&";href=href+separator+"ref=linked_lecture&ref_cid="+courseId.toString(),$el.attr("href",href)}}})}}),$(document).keydown(function(e){if(inLecture&&"object"==typeof QL_player){var player=QL_player.mediaelement_handle,media=QL_player.mediaelement_media;if(player.options.enableKeyboard)for(var i=0,il=player.options.keyActions.length;il>i;i++)for(var keyAction=player.options.keyActions[i],j=0,jl=keyAction.keys.length;jl>j;j++)if(e.keyCode==keyAction.keys[j])return e.preventDefault(),keyAction.action(player,media),!1;if("object"==typeof QL_player.mediaelement_handle)QL_player.mediaelement_handle.showControls()}})};if("function"==typeof define&&define.amd)define(["jquery","pages/spark/app","js/lib/modals","spark/app/generic/js/video_modal","spark/app/generic/js/item_list","spark/core/js/jquery.history","js/lib/bootstrap.tooltip"],function($,Coursera,Modal){return Module($,Coursera,Modal)});else if("undefined"!=typeof window&&"undefined"==typeof ender)Module(window.$,{},window.Modal)}();